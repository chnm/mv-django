{% extends 'account/_base.html' %}
{% load i18n %}
{% load static %}
{% block title %}{% trans "Email Addresses" %}{% endblock %}
{% block content_auth_form %}
  <div class="text-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900">{% trans "Email Addresses" %}</h1>
  </div>

  {% if emailaddresses %}
    <p class="text-sm text-gray-600 mb-4">{% trans "The following email addresses are associated with your account:" %}</p>

    <form method="post" action="{% url 'account_email' %}" id="email_list_form" class="mb-6">
      {% csrf_token %}
      <ul class="space-y-2 mb-4">
        {% for radio in emailaddress_radios %}
          {% with emailaddress=radio.emailaddress %}
            <li class="flex items-center gap-3 p-3 border border-gray-200 rounded-md bg-gray-50">
              <input type="radio" id="{{ radio.id }}" name="email" value="{{ emailaddress.email }}"
                     {% if radio.checked %}checked{% endif %}
                     class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
              <label for="{{ radio.id }}" class="flex-1 flex items-center gap-2 text-sm text-gray-800 cursor-pointer">
                {{ emailaddress.email }}
                {% if emailaddress.primary %}
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">{% trans "Primary" %}</span>
                {% endif %}
                {% if emailaddress.verified %}
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">{% trans "Verified" %}</span>
                {% else %}
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">{% trans "Unverified" %}</span>
                {% endif %}
              </label>
            </li>
          {% endwith %}
        {% endfor %}
      </ul>

      <div class="flex flex-wrap gap-2">
        <button type="submit" name="action_primary"
                class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          {% trans "Make Primary" %}
        </button>
        <button type="submit" name="action_send"
                class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          {% trans "Re-send Verification" %}
        </button>
        <button type="submit" name="action_remove"
                class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
          {% trans "Remove" %}
        </button>
      </div>
    </form>
  {% else %}
    <div class="mb-6 p-4 rounded-lg border-l-4 border-yellow-400 bg-yellow-50 text-yellow-800">
      <p class="text-sm">{% trans "Warning: You currently do not have any email address set up. You should really add an email address so you can receive notifications, reset your password, etc." %}</p>
    </div>
  {% endif %}

  <div class="mt-6 text-center">
    <a href="{% url 'socialaccount_connections' %}" class="text-sm text-blue-600 hover:text-blue-800 underline">
      {% trans "Manage connected accounts (GitHub, Slack, ORCID)" %}
    </a>
  </div>

  {% if can_add_email %}
    <div class="pt-6 border-t border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">{% trans "Add Email Address" %}</h2>
      <form method="post" action="{% url 'account_email' %}" class="space-y-4">
        {% csrf_token %}
        {% for field in form %}
          <div>
            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
              {{ field.label }}
            </label>
            <input type="{{ field.field.widget.input_type|default:'text' }}" name="{{ field.name }}" id="{{ field.id_for_label }}"
                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                   {% if field.value %}value="{{ field.value }}"{% endif %}>
            {% if field.errors %}
              <div class="mt-1 text-sm text-red-600">
                {% for error in field.errors %}
                  <p>{{ error }}</p>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
        <button type="submit" name="action_add"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          {% trans "Add Email" %}
        </button>
      </form>
    </div>
  {% endif %}
{% endblock content_auth_form %}
<script>
  document.getElementById("email_list_form")?.addEventListener("submit", function (e) {
    if (e.submitter?.name === "action_remove") {
      if (!confirm("{% trans 'Do you really want to remove the selected email address?' %}")) {
        e.preventDefault();
      }
    }
  });
</script>
